<!--YOUR TASKS WILL APPEAR HERE
~			TODO

~	Set up the multi window interface that we need
~	Make sure the form works
~	Get the console going
~	Make it all look nice
~ 	Import font awesome
-->
<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
	<title>WebIDE</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

    <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicons/favicon-16x16.png">
    <link rel="manifest" href="favicons/site.webmanifest">
    <link rel="mask-icon" href="favicons/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

	<link rel="stylesheet" type="text/css" id="EasyuiLayout" href="easyui/themes/default/easyui.css">
	<script type="text/javascript" src="easyui/jquery.min.js"></script>
	<script type="text/javascript" src="easyui/jquery.easyui.min.js"></script>

    <script src="codemirror-5.44.0/lib/codemirror.js"></script>
    <link rel="stylesheet" href="codemirror-5.44.0/lib/codemirror.css">
    <script src="codemirror-5.44.0/mode/javascript/javascript.js"></script>
    <script src="codemirror-5.44.0/mode/clike/clike.js"></script>

    <link rel="stylesheet" href="codemirror-5.44.0/theme/3024-day.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/3024-night.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/abcdef.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/ambiance-mobile.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/ambiance.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/base16-dark.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/base16-light.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/bespin.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/blackboard.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/cobalt.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/colorforth.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/darcula.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/duotone-dark.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/duotone-light.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/eclipse.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/elegant.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/erlang-dark.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/gruvbox-dark.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/hopscotch.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/icecoder.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/idea.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/isotope.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/lesser-dark.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/liquibyte.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/lucario.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/material.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/mbo.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/mdn-like.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/midnight.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/monokai.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/neat.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/neo.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/night.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/nord.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/oceanic-next.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/panda-syntax.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/paraiso-dark.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/paraiso-light.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/pastel-on-dark.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/railscasts.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/rubyblue.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/seti.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/shadowfox.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/solarized.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/ssms.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/the-matrix.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/tomorrow-night-bright.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/tomorrow-night-eighties.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/ttcn.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/twilight.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/vibrant-ink.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/xq-dark.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/xq-light.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/yeti.css">
    <link rel="stylesheet" href="codemirror-5.44.0/theme/zenburn.css">




</head>


<body class="easyui-layout">

    <div data-options="region:'north',border:false" style="height:55px;background:#B3DFDA;padding:10px">

        <button class="topButton" id="runButton" onclick="runCode()" type="button">Run</button> <!-- form submission stuff -->
        <form style="display: none" name="runForm" action="#" th:action="@{/code}" th:object="${code}" method="post" target="hiddenFrame">
            <input type="text" th:field="*{code}" />
            <input type="text" th:field="*{request}"/>
        </form>

        <button class="topButton" id="saveButton" onclick="saveCode()" type="button">Save</button>

        <!--<button class="topButton" id="saveAsButton">Save As</button>-->
         <!--<button class="topButton" id="debugButton">Debug</button>-->
        <button class="topButton" id="newButton">New</button>

        <button class="topButton"><label for="open-file" class="input-label"> Open
            <input style="display:none;" type="file" accept=".java" id="open-file" onchange="getFile(event);">

        </label></button>

        <button class="topButton" id="updateButton" onclick="updateEditor()" type="button">Update Theme:</button>
        <select id="cc" class="easyui-combobox" name="dept" style="width:200px;">
            <option selected>default</option>
            <option>3024-day</option>
            <option>3024-night</option>
            <option>abcdef</option>
            <option>ambiance-mobile</option>
            <option>ambiance</option>
            <option>base16-dark</option>
            <option>base16-light</option>
            <option>bespin</option>
            <option>blackboard</option>
            <option>cobalt</option>
            <option>colorforth</option>
            <option>darcula</option>
            <option>duotone-dark</option>
            <option>duotone-light</option>
            <option>eclipse</option>
            <option>elegant</option>
            <option>erlang-dark</option>
            <option>gruvbox-dark</option>
            <option>hopscotch</option>
            <option>icecoder</option>
            <option>idea</option>
            <option>isotope</option>
            <option>lesser-dark</option>
            <option>liquibyte</option>
            <option>lucario</option>
            <option>material</option>
            <option>mbo</option>
            <option>mdn-like</option>
            <option>midnight</option>
            <option>monokai</option>
            <option>neat</option>
            <option>neo</option>
            <option>night</option>
            <option>nord</option>
            <option>oceanic-next</option>
            <option>panda-syntax</option>
            <option>paraiso-dark</option>
            <option>paraiso-light</option>
            <option>pastel-on-dark</option>
            <option>railscasts</option>
            <option>rubyblue</option>
            <option>seti</option>
            <option>shadowfox</option>
            <option>solarized</option>
            <option>ssms</option>
            <option>the-matrix</option>
            <option>tomorrow-night-bright</option>
            <option>tomorrow-night-eighties</option>
            <option>ttcn</option>
            <option>twilight</option>
            <option>vibrant-ink</option>
            <option>xq-dark</option>
            <option>xq-light</option>
            <option>yeti</option>
            <option>zenburn</option>


        </select>

         <!--<button class="topButton" id="compileButton">Compile</button>-->
        <form action="#" th:action="@{/logout}" method="post">
            <button class="topRightButton" id="logoutButton" name="Log Out">Logout</button>
        </form>

    </div>


    <div data-options="region:'south',title:'Console',split:true" style="height:300px;">
        <iframe name="hiddenFrame" width="100%" height="100%"></iframe>
    </div>

    <div data-options="region:'west',title:'Files',split:true" style="width:200px;">
        <div id="sm" style="width:300px">
        </div>
    </div>

    <div data-options="region:'center',title:'Code'" style="padding:5px;">
        <textarea id="codewindow" class="codemirror-textarea" style="width:100%;height:100%;resize:vertical;overflow:auto !important"></textarea>


    </div>

</body>


<script>
    var tc;
    var changefile;
    var realedit;
    var fileName = "untitled";
    var file;

    $(document).ready(function(){
        var code = $(".codemirror-textarea")[0];
        realedit = CodeMirror.fromTextArea(document.getElementById("codewindow"), {
            lineNumbers : true,
            mode:  "text/x-java",
            theme: "default",
            matchBrackets: true,
            indentUnit: 4,
            smartIndent: true,
            tabSize: 4,
            indentWithTabs: true,
            electricChars: true,
            lineWrapping: false,
            coverGutterNextToScrollbar: true,

        });
        realedit.getDoc().setValue(
            'public class Main {\r\n' +
            '\tpublic static void main(String[] args) {\r\n' +
            '\t\tSystem.out.println("Hello World!");\r\n' +
            '\t}\r\n' +
            '}');
        changefile = realedit;
        tc = changefile.getDoc().getValue();
    });


    function getFile(event) {
        const input = event.target
        if ('files' in input && input.files.length > 0) {
            fileName = input.value.substr(input.value.indexOf('fakepath\\') + 9);
            $('#sm').sidemenu({ //sidemenu implementation doesnt do anything right now tho
                data: [{
                    text: fileName,
                    iconCls: 'icon-sum',
                    state: 'closed',
                    /*children: [{
                        text: 'notWorkingrightnow.java'
                    },{
                        text: 'itWillWorkInTime.java'
                    },{
                        text: 'src',
                        children: [{
                            text: 'comeOn.java'
                        },{
                            text: 'boi.java'
                        }]
                    }]*/
                }],
                multiple: true
            });
            updateEditor();
            placeFileContent(
                changefile.getDoc(),
                input.files[0])

        }

    }

    function placeFileContent(target, file) {
        console.log(file)
        readFileContent(file).then(content => {
            target.setValue(content);
        }).catch(error => console.log(error))
    }

    function readFileContent(file) {
        const reader = new FileReader()
        return new Promise((resolve, reject) => {
            reader.onload = event => resolve(event.target.result)
            reader.onerror = error => reject(error)
            reader.readAsText(file)
        })
    }

    function updateEditor(){
        var input = document.getElementById("cc");
        var theme = input.options[input.selectedIndex].textContent;
        realedit.setOption("theme", theme)
        var light = ["default","3024-day","ambiance-mobile","base16-light","duotone-light","eclipse","elegant","idea","mdn-like","neat","neo","paraiso-light","solarized","smss","ttcn","xq-light","yeti"];
        var dark = ["3024-night","abcdef","ambiance","base16-dark","bespin","blackboard", "cobalt","colorforth","darcula","duotone-dark","erlang-dark","gruvbox-dark","hopscotch","icecoder","isotope","lesser-dark","liquibyte","lucario","material","mbo","midnight","monokai","night","nord","oceanic-next","panda-syntax","paraiso-dark","pastel-on-dark","railscasts","rubyblue","seti","shadowfox","the-matrix","tomorrow-night-bright","tomorrow-night-eighties","twilight","vibrant-ink","xq-dark"];
        if(light.indexOf(theme) > -1){
            document.getElementById("EasyuiLayout").href = "easyui/themes/default/easyui.css";
        }
        else if(dark.indexOf(theme) > -1){
            document.getElementById("EasyuiLayout").href = "easyui/themes/black/easyui.css";
        }
    }//default theme colors: Background of Code editor: #ffffff, Background of code panel: #ededee
    //background of top bar: #B3DFD9, Color of panel headers: #E7F0FF, font of panels color: #0E365E

    function runCode() {
        tc = realedit.getValue();
        document.forms["runForm"].elements.code.value = tc;
        document.forms["runForm"].elements.request.value = "run" ;
        document.forms["runForm"].submit();
    }

    function saveCode() {
        tc = realedit.getValue();
        document.forms["runForm"].elements.code.value = tc;
        document.forms["runForm"].elements.request.value = "save" ;
        document.forms["runForm"].submit();
    }

    $('#sm').sidemenu({ //sidemenu implementation doesnt do anything right now tho
        data: [{
            text: fileName,
            iconCls: 'icon-sum',
            state: 'closed',
            /*children: [{
                text: 'notWorkingrightnow.java'
            },{
                text: 'itWillWorkInTime.java'
            },{
                text: 'src',
                children: [{
                    text: 'comeOn.java'
                },{
                    text: 'boi.java'
                }]
            }]*/
        }],
        multiple: true
    });
</script>


<style>

    .CodeMirror {
        height: auto;
    }
	html {
		margin: 0;
		height: 100;
		font-family: monospace;
		color: black;
	}
	body {
		display: grid;
		grid-template-columns: 75px, auto;
		grid-template-rows: 50px, auto;
		grid-template-areas:
				"ribbon ribbon"
				"sidenav main";
	}
	.topButton {
		background-color: rgb(0, 0, 0);
		font-family: monospace;
        color: white;
		padding: 5px;
		font-size: 18px;
        border: none;
		outline:none;
	}
    .topButton:hover {
        transition: all, 450ms, ease;
        text-decoration-line: underline;
    }
	.topButton:active {
		transition: all, 450ms, ease;
		border-color: green;
		background-color: green;
		color: white;
	}
    #file-input {
         cursor: pointer;
         outline: none;
         position: absolute;
         top: 0;
         left: 0;
         width: 0;
         height: 0;
         overflow: hidden;
         filter: alpha(opacity=0); /* IE < 9 */
         opacity: 0;
     }
    .input-label {
        cursor: pointer;
        position: relative;
        display: inline-block;
    }
	.topRightButton {
		background-color: rgb(0, 0, 0);
		font-family: monospace;
		font-size: 18px;
		outline:none;
        border: none;
        color: white;
		position:absolute;
		top:13px;
		right:13px;
        padding: 5px;
	}

    .topRightButton:hover {
        transition: all, 450ms, ease;
        text-decoration-line: underline;
    }
	.topRightButton:active {
		transition: all, 450ms, ease;
		border-color: green;
		background-color: green;
		color: white;
	}
	.sidenav {
		grid-area: sidenav;
		border-color: black;
		border-width: 5px;
		border-style: solid;

	}
	.ribbon {
		grid-area: ribbon;
		border-color: black;
		border-width: 5px;
		border-style: solid;
	}
	.main {
		grid-area: main;
		border-color: black;
		border-width: 5px;
		border-style: solid;
		width: auto;
		height: auto;
	}
	#mainWritingWindow {
		font-family: monospace;
		color: black;
		font-size: 14px;
		border-color: blue;
		border-style: solid;
		border-width: 5px;
		height: 60%;
		width: 90%;
		resize: none;
	}

</style>
</html>